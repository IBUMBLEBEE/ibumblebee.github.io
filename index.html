<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-cn">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="学无止境">
<meta name="keywords" content="DevOps">
<meta property="og:type" content="website">
<meta property="og:title" content="IBUMBLEBEE 博客">
<meta property="og:url" content="https://ibumblebee.github.io/index.html">
<meta property="og:site_name" content="IBUMBLEBEE 博客">
<meta property="og:description" content="学无止境">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IBUMBLEBEE 博客">
<meta name="twitter:description" content="学无止境">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ibumblebee.github.io/">





  <title>IBUMBLEBEE 博客</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-cn">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">IBUMBLEBEE 博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">读过两年书，尘世中一个迷途小书童</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ibumblebee.github.io/2019/11/16/supervisor 部署/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="IBUMBLEBEE">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IBUMBLEBEE 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/16/supervisor 部署/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-16T13:32:38+08:00">
                2019-11-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Supervisor-进程管理工具部署"><a href="#Supervisor-进程管理工具部署" class="headerlink" title="Supervisor 进程管理工具部署"></a>Supervisor 进程管理工具部署</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y python-pip</span><br><span class="line"><span class="meta">#</span> 安装的pip版本较低时升级，指定国内源</span><br><span class="line">pip install --upgrade pip -i https://pypi.doubanio.com/simple/</span><br><span class="line">pip install supervisor -i https://pypi.doubanio.com/simple/</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 生产配置文件</span><br><span class="line">echo_supervisord_conf &gt;&gt; /etc/supervisor/supervisord.conf</span><br><span class="line"><span class="meta">#</span> 创建子进程管理配置目录</span><br><span class="line">mkdir /etc/supervisor/supervisord.d</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 修改配置文件的几个地方，上面时原来的配置，下面为修改的配置</span><br><span class="line">[unix_http_server]</span><br><span class="line">;file=/tmp/supervisor.sock</span><br><span class="line">file=/opt/supervisor.sock</span><br><span class="line"></span><br><span class="line">[supervisorctl]</span><br><span class="line">;serverurl=unix:///tmp/supervisor.sock</span><br><span class="line">serverurl=unix:///opt/supervisor.sock</span><br><span class="line"></span><br><span class="line">[include]</span><br><span class="line">;files = relative/directory/*.ini</span><br><span class="line">files = /etc/supervisor/supervisord.d/*.ini</span><br></pre></td></tr></table></figure>

<h3 id="配置supervisor后台运行"><a href="#配置supervisor后台运行" class="headerlink" title="配置supervisor后台运行"></a>配置supervisor后台运行</h3><p>使用systemd管理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt;/usr/lib/systemd/system/supervisord.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Process Monitoring and Control Daemon</span><br><span class="line">After=rc-local.service nss-user-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/bin/supervisord -c /etc/supervisor/supervisord.conf</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"><span class="meta">&gt;</span>EOF</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start supervisord</span><br><span class="line"><span class="meta">#</span> 查看启动状态，有错排错</span><br><span class="line">systemctl status supervisord</span><br><span class="line">systemctl enable supervisord</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ibumblebee.github.io/2019/09/12/Python-面向对象编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="IBUMBLEBEE">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IBUMBLEBEE 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/12/Python-面向对象编程/" itemprop="url">Python 面向对象编程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-12T11:22:14+08:00">
                2019-09-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Python-面向对象编程思想"><a href="#Python-面向对象编程思想" class="headerlink" title="Python 面向对象编程思想"></a>Python 面向对象编程思想</h2><p>理解面向对象，理解基础概念：</p>
<p><strong>面向对象编程</strong>（Object Oriented）是将现实问题构建关系，然后抽象成类（class），给类定义属性和方法后，再将类实例化成实例（instance），通过访问实例的属性和调用方法来进行使用。</p>
<p>面向对象的三大特征：封装、继承、多态。</p>
<h2 id="面向对象常用术语"><a href="#面向对象常用术语" class="headerlink" title="面向对象常用术语"></a>面向对象常用术语</h2><ul>
<li><strong>类（Class）</strong>：用来描述具有相同属性和方法的对象的集合。它定义了该集合中每个对象所共有的属性和方法。对象是类的实例。</li>
<li><strong>类变量</strong>：类变量在整个实例化的对象中是公用的。类变量定义在类中且在函数体之外。类变量通常不作为实例变量使用。</li>
<li><strong>数据成员</strong>：类变量或者实例变量用于处理类及其实例对象的相关的数据。</li>
<li><strong>方法重载</strong>：如果从父类继承的方法不能满足子类的需求，可以对其进行改写，这个过程叫方法的覆盖（override），也称为方法的重载。</li>
<li><strong>实例变量</strong>：定义在方法中的变量，只作用于当前实例的类。</li>
<li><strong>继承</strong>：即一个派生类（derived class）继承基类（base class）的字段和方法。继承也允许把一个派生类的对象作为一个基类对象对待。例如，有这样一个设计：一个Dog类型的对象派生自Animal类，这是模拟”是一个（is-a）”关系（例图，Dog是一个Animal）。</li>
<li><strong>实例化</strong>：创建一个类的实例，类的具体对象。</li>
<li><strong>方法</strong>：类中定义的函数。</li>
<li><strong>对象</strong>：通过类定义的数据结构实例。对象包括两个数据成员（类变量和实例变量）和方法。</li>
</ul>
<h3 id="Python封装机制及实现方法"><a href="#Python封装机制及实现方法" class="headerlink" title="Python封装机制及实现方法"></a>Python封装机制及实现方法</h3><p><strong>封装（Encapsulation）</strong> 是面向对象的三大特征之一（另外两个是继承和多态），它指的是将对象的状态信息隐藏在对象内部，不允许外部程序直接访问对象内部信息，而是通过该类所提供的方法来实现对内部信息的操作和访问。</p>
<p>封装机制保证了类内部数据结构的完整性，因为使用类的用户无法直接看到类中的数据结构，只能使用类允许公开的数据，很好的避免了外部对内部数据的影响，提高了程序的可维护性。总的来说，对一个类或对象实现良好的封装，可以达到以下目的：</p>
<ul>
<li>隐藏类的实例细节。</li>
<li>让使用者只能通过事先预定的方法来访问数据，从而可以在该方法里加入控制逻辑，限制对属性的不合理访问。</li>
<li>可进行数据检查，从而有利于保证对象信息的完整性。</li>
<li>便于修改，提高代码的可维护性。</li>
</ul>
<p>为了实现良好的封装，需要从以下两个方面来考虑：</p>
<ol>
<li>将对象的属性和实现细节隐藏起来，不允许外部直接访问。</li>
<li>把方法暴露出来，让方法来控制对这些属性进行安全的访问和操作。</li>
</ol>
<p>Python 并没有提供类似于其他语言的private等修饰符，因此Python并不能真正支持隐藏。为了隐藏类中的成员，将Python类的成员命名为以双下划线开头的，Python就会把它们隐藏起来。</p>
<h3 id="Python-继承机制"><a href="#Python-继承机制" class="headerlink" title="Python 继承机制"></a>Python 继承机制</h3><p>继承是面向对象的三大特征之一，也是实现代码复用的重要手段。继承常用于创建和现有类功能类似的新类，又或是新类只需要现有类基础上添加一些成员（属性和方法），但又不想直接将现有类代码复制给新类。</p>
<p>Python中，实现继承的类成为子类，被继承的类称为父类（也可称为基类、超类）。子类继承父类的语法是：在定义时，将多个父类放在子类之后的圆括号里。语法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> 类名<span class="params">(父类<span class="number">1</span>, 父类<span class="number">2</span>, ...)</span>:</span></span><br><span class="line">    <span class="comment">#类定义部分</span></span><br></pre></td></tr></table></figure>

<p>注意Python的继承是多继承机制，即一个子类可以同时拥有多个父类。</p>
<p>object类是所有类的父类，要么是直接父类，要么是间接父类。</p>
<p>从子类的角度来看，子类扩展（extend）了父类；但从父类的角度来看，父类派生（derive）出子类。也就是说，扩展和派生所描述的是同一个动作，只是观察者的角度不同而已。</p>
<h4 id="Python多继承"><a href="#Python多继承" class="headerlink" title="Python多继承"></a>Python多继承</h4><p>由于多继承不仅增加了编程的复杂度，而且很容易导致一些莫名的错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Python 虽然在语法上明确支持多继承，但通常推荐如果不是很必要，则尽量不要使用多继承，而是使用单继承，这样可以保证编程思路更清晰，而且可以避免很多麻烦。</span><br></pre></td></tr></table></figure>

<h3 id="python多态"><a href="#python多态" class="headerlink" title="python多态"></a>python多态</h3><p>对于弱类型的语言来说，变量并没有声明类型，因此同一个变量完全可以在不同的时间引用不同的对象。当同一个变量在调用同一方法时，完全可以呈现出多种行为（具体呈现出哪种行为由该变量所引用的对象来决定），这就是所谓的多态（Polymorphism）。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://wizardforcel.gitbooks.io/w3school-python/content/24.html" target="_blank" rel="noopener">Python面向对象技术简介</a></li>
<li><a href="http://c.biancheng.net/view/2287.html" target="_blank" rel="noopener">Python 封装机制及实现方法</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ibumblebee.github.io/2019/08/08/在Centos7和Ubuntu上部署Caffe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="IBUMBLEBEE">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IBUMBLEBEE 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/08/在Centos7和Ubuntu上部署Caffe/" itemprop="url">在Centos7和Ubuntu上部署Caffe</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-08T15:10:09+08:00">
                2019-08-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Centos-Caffe-部署"><a href="#Centos-Caffe-部署" class="headerlink" title="Centos Caffe 部署"></a>Centos Caffe 部署</h2><h3 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h3><ul>
<li>Centos 7</li>
<li>OpenCV 3.3.1</li>
<li>Cmake-3.15.1</li>
<li>Python 2.7.5</li>
<li>virtualenv 虚拟环境</li>
</ul>
<h3 id="编译-OpenCV"><a href="#编译-OpenCV" class="headerlink" title="编译 OpenCV"></a>编译 OpenCV</h3><h4 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install epel-release \</span><br><span class="line">            git wget unzip gcc gcc-c++ cmake cmake3 \</span><br><span class="line">            qt5-qtbase-devel \</span><br><span class="line">            python python-devel python-pip \</span><br><span class="line">            gtk2-devel \</span><br><span class="line">            libpng-devel \</span><br><span class="line">            jasper-devel \</span><br><span class="line">            openexr-devel \</span><br><span class="line">            libwebp-devel \</span><br><span class="line">            libjpeg-turbo-devel \</span><br><span class="line">            freeglut-devel mesa-libGL mesa-libGL-devel \</span><br><span class="line">            libtiff-devel \</span><br><span class="line">            libdc1394-devel \</span><br><span class="line">            tbb-devel eigen3-devel \</span><br><span class="line">            libv4l-devel \</span><br><span class="line">            gstreamer-plugins-base-devel</span><br></pre></td></tr></table></figure>

<h4 id="安装-ffmpeg"><a href="#安装-ffmpeg" class="headerlink" title="安装 ffmpeg"></a>安装 ffmpeg</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y epel-release</span><br><span class="line">rpm -v --import http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro</span><br><span class="line">rpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm</span><br><span class="line">yum install -y ffmpeg ffmpeg-devel</span><br><span class="line">ffmpeg -version</span><br></pre></td></tr></table></figure>

<h4 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv virtualenvwrapper -i https://pypi.doubanio.com/simple/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里注意使用Python2和Python3</span></span><br><span class="line">echo "export WORKON_HOME=/root/.virtualenvs" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "source /usr/bin/virtualenvwrapper.sh" &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br><span class="line">mkvirtualenv OpenCV-3.3.1-py2 -p python</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下次进入的时候使用</span></span><br><span class="line">workon OpenCV-3.3.1-py2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 阿里云服务器默认选用阿里源，可取消 -i 参数</span></span><br><span class="line">pip install cmake -i https://pypi.doubanio.com/simple/</span><br><span class="line">pip install numpy==1.11.0 scipy==0.17.0 matplotlib==2.1.1 scikit-image==0.13.1  ipython==5.5 scikit-learn dlib -i https://pypi.doubanio.com/simple/</span><br></pre></td></tr></table></figure>

<h4 id="OpenCV-编译安装"><a href="#OpenCV-编译安装" class="headerlink" title="OpenCV 编译安装"></a>OpenCV 编译安装</h4><p>OpenCV 安装版本选择是根据 anaconda 安装 Caffe 时，依赖安装的是 OpenCV-3.3.1。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载对应版本的OpenCV，并解压</span></span><br><span class="line"></span><br><span class="line">mkdir /opt/opencv_3rdparty</span><br><span class="line">cd /opt/opencv_3rdparty</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载编译OpenCV时需要的依赖</span></span><br><span class="line"></span><br><span class="line">sed -i 's/https:\/\/raw.githubusercontent.com\/opencv\/opencv_3rdparty\/\$&#123;IPPICV_COMMIT&#125;\/ippicv\//file:\/\/\/opt\/opencv_3rdparty\//g' ./opencv-3.3.1/3rdparty/ippicv/ippicv.cmake</span><br><span class="line"></span><br><span class="line">export ENV_OPENCV_PY=/root/.virtualenvs/OpenCV-3.3.1-py2</span><br><span class="line">cd opencv-3.3.1 &amp;&amp; mkdir build &amp;&amp; cd build</span><br><span class="line"><span class="meta">#</span><span class="bash"> CMAKE_INSTALL_PREFIX 安装路径，这个一般指定Python模块安装路径的lib上层。当然还可以指定别的路径，注意加载环境变量。在虚拟环境中，直接是家目录。该包生成的Python模块是标准的，可以直接指定Python包安装路径。如果安装错误也没关系，可以使用软链接方式，具体方式请自行网上查找。</span></span><br><span class="line">cmake -D CMAKE_BUILD_TYPE=Release \</span><br><span class="line">      -D WITH_FFMPEG=ON \</span><br><span class="line">      -D CMAKE_INSTALL_PREFIX=$ENV_OPENCV_PY \</span><br><span class="line">      -D PYTHON_EXECUTABLE=$ENV_OPENCV_PY/bin/python \</span><br><span class="line">      -D PYTHON_INCLUDE_DIR=$ENV_OPENCV_PY/include/python2.7 \</span><br><span class="line">      -D PYTHON_LIBRARY=$ENV_OPENCV_PY/lib/python2.7/config/libpython2.7.so \</span><br><span class="line">      -D PYTHON_NUMPY_INCLUDE_DIRS=$ENV_OPENCV_PY/lib/python2.7/site-packages/numpy/core/include/ ..</span><br><span class="line"></span><br><span class="line">make -j$(nproc)</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试生成的Python 模块</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;import cv2</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;import os.path.dirname(os.__file__)</span></span><br></pre></td></tr></table></figure>

<h3 id="编译-Caffe"><a href="#编译-Caffe" class="headerlink" title="编译 Caffe"></a>编译 Caffe</h3><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><p>按照官网要求，安装 boost-devel 开发包时会安装依赖包 boost-1.53，该版本过低，暂不安装。</p>
<h4 id="编译安装-Boost-1-58-（Caffe-编译需要依赖这个-C-库，版本-1-55-以上）"><a href="#编译安装-Boost-1-58-（Caffe-编译需要依赖这个-C-库，版本-1-55-以上）" class="headerlink" title="编译安装 Boost-1.58 （Caffe 编译需要依赖这个 C++库，版本 1.55 以上）"></a>编译安装 Boost-1.58 （Caffe 编译需要依赖这个 C++库，版本 1.55 以上）</h4><p>由于 Centos yum 安装是 Boost-1.53 版本，不符合要求。需要编译安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc-c++ python-devel bzip2-devel zlib-devel</span><br><span class="line">wget https://nchc.dl.sourceforge.net/project/boost/boost/1.58.0/boost_1_58_0.zip</span><br><span class="line">unzip boost_1_58_0.zip</span><br><span class="line">cd boost_1_58_0 &amp;&amp; ./bootstrap.sh --prefix=/usr/local/boost</span><br><span class="line">./b2</span><br><span class="line">cd tools/build &amp;&amp; ./bootstrap.sh</span><br><span class="line">./b2 install --prefix=/usr/local/boost</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">yum install -y protobuf-devel leveldb-devel snappy-devel hdf5-devel</span><br><span class="line"></span><br><span class="line">pip install protobuf -i https://pypi.doubanio.com/simple/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> glog 请注意，glog不能使用最新的gflags版本（2.1）进行编译，因此在解决之前，您需要先使用glog进行构建。</span></span><br><span class="line">wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/google-glog/glog-0.3.3.tar.gz</span><br><span class="line">tar zxvf glog-0.3.3.tar.gz</span><br><span class="line">cd glog-0.3.3</span><br><span class="line">./configure</span><br><span class="line">make -j$(nproc) &amp;&amp; make install</span><br><span class="line"><span class="meta">#</span><span class="bash"> gflags</span></span><br><span class="line">wget https://github.com/schuhschuh/gflags/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line">cd gflags-master</span><br><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line">export CXXFLAGS="-fPIC" &amp;&amp; cmake .. &amp;&amp; make VERBOSE=1</span><br><span class="line">make -j$(nproc) &amp;&amp; make install</span><br><span class="line"><span class="meta">#</span><span class="bash"> lmdb</span></span><br><span class="line">git clone https://github.com/LMDB/lmdb</span><br><span class="line">cd lmdb/libraries/liblmdb</span><br><span class="line">make -j$(nproc) &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为获得更好的CPU 性能</span></span><br><span class="line">yum install -y atlas-devel</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用cmake 编译</span></span><br><span class="line">git clone https://github.com/BVLC/caffe.git</span><br><span class="line">cd caffe</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改编译配置</span></span><br><span class="line">cp Makefile.config.example Makefile.config</span><br><span class="line"><span class="meta">#</span><span class="bash"> CPU_ONLY=1 仅仅 CPU 模式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS := atlas  CPU更好性能</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_INCLUDE := /usr/include/atlas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_LIB := /usr/lib64/atlas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Python库相关路径配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_INCLUDE，PYTHON_LIB</span></span><br><span class="line"></span><br><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 该文档只是使用cmake编译，make编译尚未验证。cmake编译时需要atlas相关的动态库，不然编译时会报错找不到Atlas_CBLAS_LIBRARY,Atlas_BLAS_LIBRARY,Atlas_LAPACK_LIBRARY 库。cmake 编译的Makefile在Caffe源码目录下<span class="variable">$CAFFE_ROOT</span>/cmake/Modules/FindAtlas.cmake</span></span><br><span class="line">ln -sv /usr/lib64/atlas/libsatlas.so.3.10 /usr/lib64/atlas/libcblas.so</span><br><span class="line">ln -sv /usr/lib64/atlas/libsatlas.so.3.10 /usr/lib64/atlas/libatlas.so</span><br><span class="line">ln -sv /usr/lib64/atlas/libsatlas.so.3.10 /usr/lib64/atlas/liblapack.so</span><br><span class="line"></span><br><span class="line">cmake ..</span><br><span class="line">make -j$(nproc) all</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里编译完成之后，会有相关的设置环境变量提示，注意保存并添加环境变量。</span></span><br><span class="line">make -j$(nproc) install</span><br><span class="line">make -j$(nproc) runtest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置环境变量到~/.bashrc，注意是虚拟环境的家目录。</span></span><br><span class="line">export CAFFE_ROOT=/opt/caffe-1.0</span><br><span class="line">export PYCAFFE_ROOT=$CAFFE_ROOT/build/install/python</span><br><span class="line">export PYTHONPATH=$PYCAFFE_ROOT:$PYTHONPATH</span><br><span class="line">export PATH=$CAFFE_ROOT/build/tools:$PYCAFFE_ROOT:$CAFFE_ROOT/build/install/lib:/opt/boost_1_58_0/stage/lib:$WORKON_HOME/OpenCV-3.3.1-py2/lib:/usr/local/lib:/usr/lib64/atlas:$CAFFE_ROOT/build/install/python/caffe/_caffe.so:$PATH</span><br><span class="line"></span><br><span class="line">source ~/.bashrc</span><br><span class="line"></span><br><span class="line">echo /opt/caffe-1.0/build/lib &gt; /etc/ld.so.conf.d/caffe.conf</span><br><span class="line">ldconfig</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试caffe</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;import caffe</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;import os</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;<span class="built_in">print</span> os.path.dirname(caffe.__file__)</span></span><br></pre></td></tr></table></figure>

<h2 id="Ubuntu-Caffe-OpenCV-安装部署"><a href="#Ubuntu-Caffe-OpenCV-安装部署" class="headerlink" title="Ubuntu Caffe OpenCV 安装部署"></a>Ubuntu Caffe OpenCV 安装部署</h2><h3 id="前置条件-1"><a href="#前置条件-1" class="headerlink" title="前置条件"></a>前置条件</h3><ul>
<li>Ubuntu 16.04</li>
<li>OpenCV 3.3.1</li>
<li>Cmake-3.15.1</li>
<li>Python 2.7.12</li>
</ul>
<h3 id="编译-OpenCV-1"><a href="#编译-OpenCV-1" class="headerlink" title="编译 OpenCV"></a>编译 OpenCV</h3><h4 id="安装依赖包-1"><a href="#安装依赖包-1" class="headerlink" title="安装依赖包"></a>安装依赖包</h4><p>安装 Python 以及 OpenCV 安装所需的其他库和包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install cmake</span><br><span class="line">sudo apt-get install build-essential \</span><br><span class="line">             libgtk2.0-dev \</span><br><span class="line">             libavcodec-dev \</span><br><span class="line">             libavformat-dev \</span><br><span class="line">             libjpeg.dev \</span><br><span class="line">             libtiff4.dev \</span><br><span class="line">             libswscale-dev \</span><br><span class="line">             libjasper-dev</span><br></pre></td></tr></table></figure>

<h4 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这里的包版本是按照项目Python包的具体版本安装的，不是必须这样的。只需要满足条件即可。</span></span><br><span class="line">pip install numpy==1.11.0 scipy==0.17.0 matplotlib==2.1.1 scikit-image==0.13.1  ipython==5.5 scikit-learn dlib</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改编译安装下载依赖</span></span><br><span class="line">mkdir /opt/opencv_3rdparty</span><br><span class="line">cd /opt/opencv_3rdparty</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/ippicv/master_20180723/ippicv/ippicv_2019_lnx_intel64_general_20180723.tgz</span><br><span class="line"></span><br><span class="line">wget https://github.com/opencv/opencv/archive/opencv-3.3.1.zip</span><br><span class="line">unzip opencv-3.3.1.zip</span><br><span class="line">cd opencv-3.3.1</span><br><span class="line">sed -i 's/https:\/\/raw.githubusercontent.com\/opencv\/opencv_3rdparty\/\$&#123;IPPICV_COMMIT&#125;\/ippicv\//file:\/\/\/opt\/opencv_3rdparty\//g' ./opencv-3.3.1/3rdparty/ippicv/ippicv.cmake</span><br><span class="line"></span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意修改对应路径地址 python 路径，有可能是虚拟环境的</span></span><br><span class="line">cmake -D CMAKE_BUILD_TYPE=Release \</span><br><span class="line">      -D WITH_FFMPEG=ON \</span><br><span class="line">      -D CMAKE_INSTALL_PREFIX=/usr/local \</span><br><span class="line">      -D OPENCV_PYTHON2_INSTALL_PATH=/usr/local/lib/python2.7/dist-packages/ \</span><br><span class="line">      -D PYTHON_EXECUTABLE=/usr/bin/python \</span><br><span class="line">      -D PYTHON_INCLUDE_DIR=/usr/include/python2.7 \</span><br><span class="line">      -D PYTHON_INCLUDE_DIR2=/usr/include/x86_64-linux-gnu/python2.7 \</span><br><span class="line">      -D PYTHON_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython2.7.so \</span><br><span class="line">      -D PYTHON_INCLUDE_DIRS=/usr/local/lib/python2.7/dist-packages/numpy/core/include/ ..</span><br><span class="line"></span><br><span class="line">make -j$(nproc)</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="测试-OpenCV-Python-模块"><a href="#测试-OpenCV-Python-模块" class="headerlink" title="测试 OpenCV Python 模块"></a>测试 OpenCV Python 模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">print</span> cv2.__version__</span><br><span class="line"><span class="number">3.3</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h3 id="编译-Caffe-1"><a href="#编译-Caffe-1" class="headerlink" title="编译 Caffe"></a>编译 Caffe</h3><h4 id="通用依赖"><a href="#通用依赖" class="headerlink" title="通用依赖"></a>通用依赖</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; apt-get install -y --no-install-recommends \</span><br><span class="line">        build-essential \</span><br><span class="line">        cmake \</span><br><span class="line">        git \</span><br><span class="line">        wget \</span><br><span class="line">        libatlas-base-dev \</span><br><span class="line">        libboost-all-dev \</span><br><span class="line">        libgflags-dev \</span><br><span class="line">        libgoogle-glog-dev \</span><br><span class="line">        libhdf5-serial-dev \</span><br><span class="line">        libleveldb-dev \</span><br><span class="line">        liblmdb-dev \</span><br><span class="line">        libopencv-dev \</span><br><span class="line">        libprotobuf-dev \</span><br><span class="line">        libsnappy-dev \</span><br><span class="line">        protobuf-compiler \</span><br><span class="line">        python-dev \</span><br><span class="line">        python-numpy \</span><br><span class="line">        python-pip \</span><br><span class="line">        python-setuptools \</span><br><span class="line">        python-scipy</span><br></pre></td></tr></table></figure>

<h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载源码 解压</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装编译依赖的Python，在caffe 源码包Python目录下，尽量安装项目依赖的包的具体版本安装，只要满足python目录下包版本需求即可。</span></span><br><span class="line"></span><br><span class="line">cd python &amp;&amp; for req in $(cat requirements.txt); do pip install $req; done &amp;&amp; cd ..</span><br><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 仅CPU加速</span></span><br><span class="line">cmake -D CPU_ONLY=1 ..</span><br><span class="line">make -j$(nproc)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置Caffe Python包环境变量</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Caffe 源码包路径视情况而定</span></span><br><span class="line">echo "export CAFFE_ROOT=/opt/download/caffe-1.0" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "export PYCAFFE_ROOT=$CAFFE_ROOT/python" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "export PYTHONPATH=$PYCAFFE_ROOT:$PYTHONPATH" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "export PATH=$CAFFE_ROOT/build/tools:$PYCAFFE_ROOT:$PATH" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "$CAFFE_ROOT/build/lib" &gt;&gt; /etc/ld.so.conf.d/caffe.conf &amp;&amp; ldconfig</span><br><span class="line"></span><br><span class="line">source ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试Caffe 包是否可用</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;import caffe</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;<span class="built_in">print</span> caffe.__version__</span></span><br><span class="line">1.0.0</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ibumblebee.github.io/2019/08/06/istio-组件之-Pilot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="IBUMBLEBEE">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IBUMBLEBEE 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/06/istio-组件之-Pilot/" itemprop="url">istio 组件之 Pilot</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-06T22:43:18+08:00">
                2019-08-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="流量管理"><a href="#流量管理" class="headerlink" title="流量管理"></a>流量管理</h2><p>本文主要讲述 Istio 中流量管理的工作原理，包括流量管理原则的有点。本文假设你已经阅读了 Istio 是什么？并熟悉 Istio 的高级架构。</p>
<h3 id="Pilot-和-Envoy"><a href="#Pilot-和-Envoy" class="headerlink" title="Pilot 和 Envoy"></a>Pilot 和 Envoy</h3><p>Istio 流量管理的核心组件是 Pilot，它管理和部署在特定 istio 服务网格中的所以 Envoy 代理实例。它允许自己制定在 Envoy 之间使用什么样的<br>路由规则，并配合故障恢复功能，如超时、重试和熔断器。它还维护了网格中所有的规范模型，并使用这个模型通过发现服务让 Envoy 了解网格中的<br>其他实例。</p>
<p>每个 Envoy 实例都会维护负载均衡信息，负载均衡信息是基于从 Pilot 或者的信息，以及其他负载均衡池中的其他实例的定期健康检查。从而允许其在目标实例之间职能分配流量，同事遵循其指定的路由规则。</p>
<p><img src="https://istio.io/docs/concepts/traffic-management/PilotAdapters.svg" alt="Pilot 架构"></p>
<p>Pilot 公开了用于服务发现、负载均衡池和路由表的动态更新的 API。</p>
<p>运维人员可以通过 Pilot 的 Rules API 指定高级流量管理规则。这些规则被翻译成低级配置，并通过 discovery API 分发到 Envoy 实例。</p>
<hr>
<h4 id="路由请求"><a href="#路由请求" class="headerlink" title="路由请求"></a>路由请求</h4><h4 id="服务之间的通讯"><a href="#服务之间的通讯" class="headerlink" title="服务之间的通讯"></a>服务之间的通讯</h4><h4 id="Ingress-和-Egress"><a href="#Ingress-和-Egress" class="headerlink" title="Ingress 和 Egress"></a>Ingress 和 Egress</h4><h4 id="服务发现和负载均衡"><a href="#服务发现和负载均衡" class="headerlink" title="服务发现和负载均衡"></a>服务发现和负载均衡</h4><p>服务的所有的 HTTP 流量都会通过 Envoy 自动重新路由。Envoy 在负载均衡池中的时候之间分发流量。虽然 Envoy 支持多种复杂的负载负载算法（Round robin，Ring hash，Weighted least request，Random，Original destination），但 istio 目前仅允许三种负载均衡模式：轮询、随机和带权重的最少请求。</p>
<p>除了负载均衡外，Envoy 还会定期检查池中每个实例的运行状况。Envoy 遵循熔断器风格模式，根据健康检查 API 调用的失败率将实例分类为不健康或健康。换句话说，当给定实例的健康检查失败次数超过预定阈值时，它将从负载均衡池中弹出。类似地，当通过的健康检查数超过预定阈值时，该实例将被添加回负载均衡池。您可以在处理故障中了解更多有关 Envoy 的故障处理功能。</p>
<h4 id="故障处理"><a href="#故障处理" class="headerlink" title="故障处理"></a>故障处理</h4><p>Envoy 提供了一套开箱即用，可选的的故障恢复功能，对应用中的服务大有裨益。这些功能包括：</p>
<ol>
<li>超时</li>
<li>具备超时预算，并能够在重试之间进行可变抖动（间隔 ）的有限重试功能</li>
<li>并发连接数个上游服务请求数限制</li>
<li>对负载均衡池中的每个成员进行（定期）运行健康检查</li>
<li>细粒度熔断器（被动健康检查）- 适用于负载均衡池中的每个实例</li>
</ol>
<h4 id="微调"><a href="#微调" class="headerlink" title="微调"></a>微调</h4><p>Istio 的流量管理规则允许运维人员为每个服务/版本设置故障恢复的全局默认值。然而，服务的消费者也可以通过特殊的 HTTP 头提供的请求级别值覆盖超时和重试的默认值。在 Envoy 代理的实现中，对应的 Header 分别是 x-envoy-upstream-rq-timeout-ms 和 x-envoy-max-retries。</p>
<h4 id="故障注入"><a href="#故障注入" class="headerlink" title="故障注入"></a>故障注入</h4><p>istio 能在不杀死 Pod 的情况下，将协议特定的故障注入到网络中，在 TCP 层制造数据包的延迟或者损坏。</p>
<hr>
<h4 id="规则配置"><a href="#规则配置" class="headerlink" title="规则配置"></a>规则配置</h4><p>istio 提供了一个简单的配置模型，用来控制 API 调用以及应用部署多个服务之间的四层通信。istio 中包含有四种流量管理配置资源，分别是 VirtualService、DestinationRule、ServiceEntry 以及 Gateway。</p>
<ul>
<li>VirtualService 在 istio 服务网格中定义路由规则，控制路由如何路由到服务上。</li>
<li>DestinationRule 是 VirtualService 路由生效后，配置应用  与请求成都策略集。</li>
<li>ServiceEntry 是通常用于在 istio 服务网格之外启用对服务的请求。</li>
<li>Gateway 为 HTTP/TCP 流量配置负载均衡器，最常见的是在网格的边缘的操作，以启动应用程序的入口流量。</li>
</ul>
<h5 id="Virtual-Service"><a href="#Virtual-Service" class="headerlink" title="Virtual Service"></a>Virtual Service</h5><p>VirtualService 定义了控制在 istio 服务网格中如何路由服务请求的规则。</p>
<ul>
<li>规则的目标描述</li>
<li>在服务之间拆分流量</li>
<li>超时和重试</li>
<li>错误注入 在根据路由规则向选中  目标转发 http 请求的时候，可以向其中注入一个或多个错误。错误可以是延迟，也可以是退出。</li>
<li>条件规则<ul>
<li>使用工作负载 label 限制特定客户端工作负载。</li>
<li>根据 HTTP Header 选择规则。</li>
<li>根据请求 URI 选择规则。</li>
</ul>
</li>
<li>多重匹配条件：可以同事设置多个条件。在这种情况下，根据嵌套，应用 AND 或 OR 语义。如果多个小件嵌套在单个匹配  子句中，则条件为 AND。</li>
</ul>
<p>AND 条件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VirtualService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">ratings</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  hosts:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">ratings</span></span><br><span class="line"><span class="attr">  http:</span></span><br><span class="line"><span class="attr">  - match:</span></span><br><span class="line"><span class="attr">    - sourceLabels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">reviews</span></span><br><span class="line"><span class="attr">        version:</span> <span class="string">v2</span></span><br><span class="line">      <span class="comment"># 与 OR 不同</span></span><br><span class="line"><span class="attr">      headers:</span></span><br><span class="line"><span class="attr">        end-user:</span></span><br><span class="line"><span class="attr">          exact:</span> <span class="string">jason</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure>

<p>OR 条件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VirtualService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">ratings</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  hosts:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">ratings</span></span><br><span class="line"><span class="attr">  http:</span></span><br><span class="line"><span class="attr">  - match:</span></span><br><span class="line"><span class="attr">    - sourceLabels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">reviews</span></span><br><span class="line"><span class="attr">        version:</span> <span class="string">v2</span></span><br><span class="line">    <span class="comment"># 与 AND 不同</span></span><br><span class="line"><span class="attr">    - headers:</span></span><br><span class="line"><span class="attr">        end-user:</span></span><br><span class="line"><span class="attr">          exact:</span> <span class="string">jason</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure>

<ul>
<li>优先级：当对一个目标多个规则时，会按照在 virtualService 中的顺序进行应用，换句话说，列表中的第一条规则具体最高优先级。<ul>
<li>为什么优先级重要：当对某个服务的路由是完全基于权重的时候，就可以在单一规则中完成。另一方面，如果有多重条件用来进行路由，就会需要不知一条规则。这样就会出现优先级问题，需要通过优先级来保证根据正确的顺序来执行。</li>
</ul>
</li>
</ul>
<h5 id="目标规则"><a href="#目标规则" class="headerlink" title="目标规则"></a>目标规则</h5><p>在请求被 VirtualService 路由之后，DestinationRule 配置的一系列策略就生效了。这些策略路由服务  属主编写， 包含断路器、负载均衡以及 TLS 等的配置内容。</p>
<p>DestinationRule 还定义了对应目标主机的可路由 subset。VirtualService 在向特定服务版本发送请求时会用到这些子集。</p>
<ul>
<li>断路器：可以用一系列的标准，例如连接数和请求数限制来定义简单的断路器。</li>
<li>规则评估</li>
</ul>
<h5 id="Service-Entry"><a href="#Service-Entry" class="headerlink" title="Service Entry"></a>Service Entry</h5><p>istio 内部会维护一个服务注册表，可以用 ServiceEntry 向其中加入额外的条目。通常这个对象用来启用对 ISTIO 服务网格之外的服务发出请求。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceEntry</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">foo-ext-svc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  hosts:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">*.foo.com</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - number:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">http</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">HTTP</span></span><br><span class="line"><span class="attr">  - number:</span> <span class="number">443</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">https</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">HTTPS</span></span><br></pre></td></tr></table></figure>

<p>ServiceEntry 中使用 hosts 字段来指定目标，字段值可以是一个完全限定名，也可以是通配符域名。其中包含的白名单，包含一个或多个允许网格中服务访问的服务。</p>
<p>ServiceEntry 的配合不仅限于外部服务，它有两种类型：网格内部和网格外部。网格内的条目和其他的内部服务类似，用于显式的将服务加入网格。可以用来把服务作为服务网格扩展的一部分加入不受管理的基础设置。网格外的条目用于表达网格外的服务。对这种条目来说，双向 TLS 认证被禁用，策略实现需要在客户端执行，而不像内部服务请求那样在服务端执行。</p>
<h5 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h5><p>Gateway 为 HTTP/TCP 流量配置了一个负载均衡，多数情况下在网格边缘进行操作，用于启用一个服务的入口（ingress）流量。</p>
<p>和 kubernetes ingress 不同，istio Gateway 只配置四层到六层的功能（例如开放端口或者 TLS 配置）。绑定一个 VirtualService 到 Gateway 上，用户就可以使用标准的 istio 规则来控制进入 HTTP 和 TCP 流量。</p>
<h5 id="EnvoyFilter"><a href="#EnvoyFilter" class="headerlink" title="EnvoyFilter"></a>EnvoyFilter</h5><p>EnvoyFilter 描述了  针对代理服务的过滤器，用来定制有 istio Pilot 生成的代理配置。一定要谨慎使用此功能。错误的配置内容一旦完成传播，可能会令这个服务网格陷入瘫痪。这配置是用于对 istio 网格系统内部  实现进行变更的，属于高级配置，用于扩展 Envoy 中的过滤器的。</p>
<h3 id="Istio-中的-Sidecar-注入与流量劫持详解"><a href="#Istio-中的-Sidecar-注入与流量劫持详解" class="headerlink" title="Istio 中的 Sidecar 注入与流量劫持详解"></a>Istio 中的 Sidecar 注入与流量劫持详解</h3><p>讲解之前先了解几个概念：</p>
<ul>
<li>Sidecar 模式：容器应用模式之一，Service Mesh 架构的一种实现方式。</li>
<li>init 容器：Pod 中的一种专门的容器，在应用程序容器启动之前运行，用来包含一些应用镜像中不存在的实用工具或安装脚本。</li>
<li>IPtable：流量劫持是通过 IPtable 转发实现的。</li>
</ul>
<h4 id="Init-容器解析"><a href="#Init-容器解析" class="headerlink" title="Init 容器解析"></a>Init 容器解析</h4><p>istio 在 pod 中注入的 Init 容器为 istio-init，可以查看已经注入的 pod 的 init 容器启动参数（根据 YAML 文件描述）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-p 15001 -u 1337 -m REDIRECT -i '*' -x "" -b 9080 -d ""</span><br></pre></td></tr></table></figure>

<p>可以在源码中查看该容器的<a href="https://github.com/istio/istio/blob/master/pilot/docker/Dockerfile.proxy_init" target="_blank" rel="noopener">Dockerfile</a>看看启动命令。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:xenial</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get upgrade -y &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="bash">    iproute2 \</span></span><br><span class="line"><span class="bash">    iptables \</span></span><br><span class="line"><span class="bash"> &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> istio-iptables.sh /usr/<span class="built_in">local</span>/bin/</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/usr/local/bin/istio-iptables.sh"</span>]</span></span><br></pre></td></tr></table></figure>

<p>我们看到 istio-init 容器的入口是/usr/local/bin/istio-iptables.sh 脚本，该脚本在 istio 源码仓库中是<a href="https://github.com/istio/istio/blob/master/tools/deb/istio-iptables.sh" target="_blank" rel="noopener">istio-iptables.sh</a></p>
<h5 id="init-容器启动入口"><a href="#init-容器启动入口" class="headerlink" title="init 容器启动入口"></a>init 容器启动入口</h5><p>init 容器的启动入口是/usr/local/bin/istio-iptables.sh 脚本，该脚本的用法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">istio-iptables.sh -p PORT -u UID -g GID [-m mode] [-b ports] [-d ports] [-i CIDR] [-x CIDR] [-h]</span><br><span class="line">  -p: 指定重定向所有 TCP 流量的 Envoy 端口（默认为 $ENVOY_PORT = 15001）</span><br><span class="line">  -u: 指定未应用重定向的用户的 UID。通常，这是代理容器的 UID（默认为 $ENVOY_USER 的 uid，istio_proxy 的 uid 或 1337）</span><br><span class="line">  -g: 指定未应用重定向的用户的 GID。（与 -u param 相同的默认值）</span><br><span class="line">  -m: 指定入站连接重定向到 Envoy 的模式，“REDIRECT” 或 “TPROXY”（默认为 $ISTIO_INBOUND_INTERCEPTION_MODE)</span><br><span class="line">  -b: 逗号分隔的入站端口列表，其流量将重定向到 Envoy（可选）。使用通配符 “*” 表示重定向所有端口。为空时表示禁用所有入站重定向（默认为 $ISTIO_INBOUND_PORTS）</span><br><span class="line">  -d: 指定要从重定向到 Envoy 中排除（可选）的入站端口列表，以逗号格式分隔。使用通配符“*” 表示重定向所有入站流量（默认为 $ISTIO_LOCAL_EXCLUDE_PORTS）</span><br><span class="line">  -i: 指定重定向到 Envoy（可选）的 IP 地址范围，以逗号分隔的 CIDR 格式列表。使用通配符 “*” 表示重定向所有出站流量。空列表将禁用所有出站重定向（默认为 $ISTIO_SERVICE_CIDR）</span><br><span class="line">  -x: 指定将从重定向中排除的 IP 地址范围，以逗号分隔的 CIDR 格式列表。使用通配符 “*” 表示重定向所有出站流量（默认为 $ISTIO_SERVICE_EXCLUDE_CIDR）。</span><br><span class="line"></span><br><span class="line">环境变量位于 $ISTIO_SIDECAR_CONFIG（默认在：/var/lib/istio/envoy/sidecar.env）</span><br></pre></td></tr></table></figure>

<p>通过查看该脚本你将看到，以上传入的参数都会重新组装成 IPtable 命令参数。</p>
<p>在参考 istio-init 容器的启动参数，完整的启动  命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/istio-iptables.sh -p 15001 -u 1337 -m REDIRECT -i '*' -x "" -b 9080 -d ""</span><br></pre></td></tr></table></figure>

<p>该容器存在的意义就是让 Envoy 代理可以拦截所有进出 pod 的流量，即将入站流量重定向到 Sidecar，在拦截应用容器的出站流量经过 Sidecar 处理后再出站。</p>
<p><strong>命令解析</strong></p>
<p>这条启动命令的作用是：</p>
<ul>
<li>将应用容器的所有流量都转发到 Envoy 的 15001 端口。</li>
<li>使用 istio-proxy 用于身份运行，UID 为 1337，即 Envoy 所处的用户控件，这也是 istio-proxy 容器默认使用的用户，见 YAML 配置中的 runAsUser 字段。</li>
<li>使用默认的 REDIRECT 模式来重定向流量。</li>
<li>将所有出站流量重定向到 Envoy 代理。</li>
<li>将所有访问 9080 端口的流量重定向到 Envoy 代理。</li>
</ul>
<p>因为 Init 容器初始化完成就会自动终止，因为我们无法登陆到容器中查看 IPtable 信息，但是 init 容器初始化结果会保留到应用容器和 Sidecar 容器中。</p>
<p><strong>istio-proxy 容器解析</strong></p>
<p>为了查看 IPtables 配置，我们需要登录到 Sidecar 容器中使用 root 用用户来查看，因为 kubectl 无法使用特权默认来远程操作 docker 容器，所以我们需要登录到 productpage POD 所在的主机上 docker 命令登录容器中看。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 以特权模式进入容器，可以查看IPtable规则。</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker <span class="built_in">exec</span> -i --privileged -t 781b67a78a70 bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看NAT 表中规则配置的详细信息</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> iptables -t nat -L -v</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PREROUTING 链：用于目标地址转换（DNAT），将所有入站TCP流量跳转到 ISTIO_INBOUND 链上</span></span><br><span class="line">Chain PREROUTING (policy ACCEPT 1 packets, 60 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    1    60 ISTIO_INBOUND  tcp  --  any    any     anywhere             anywhere</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> INPUT 链：处理输入数据包，非TCP流量将继续OUTPUT链</span></span><br><span class="line">Chain INPUT (policy ACCEPT 1 packets, 60 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> OUTPUT 链：将所有出站数据包跳转到ISTIO_OUTPUT 链上</span></span><br><span class="line">Chain OUTPUT (policy ACCEPT 1398 packets, 131K bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    2   120 ISTIO_OUTPUT  tcp  --  any    any     anywhere             anywhere</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> POSTROUTING 链：所有数据包流出网卡时都要先进入POSTROUTING 链，内核根据数据包目的地判断是否需要转发出去，我们看到未做任何处理</span></span><br><span class="line">Chain POSTROUTING (policy ACCEPT 1398 packets, 131K bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ISTIO_INBOUND 链：将所有目的端口为9080的端口入站流量重定向到ISTIO_IN_REDIRECT 链上</span></span><br><span class="line">Chain ISTIO_INBOUND (1 references)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 ISTIO_IN_REDIRECT  tcp  --  any    any     anywhere             anywhere             tcp dpt:9080</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ISTIO_IN_REDIRECT 链：将所有的入站流量跳转到本地的15001端口，至此成功的拦截了流量到Envoy</span></span><br><span class="line">Chain ISTIO_IN_REDIRECT (1 references)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports 15001</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ISTIO_OUTPUT 链：选择需要重定向到Envoy（即本地）的出站流量，所有非localhost的流量全部转发到ISTIO_REDIRECT。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为了避免流量在该POD中无限循环，所有到istio-proxy用于空间的的流量都返回到它的调用点中的下一条规则，本例中即</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> OUTPUT链，因为跳出ISTIO_OUTPUT 规则之后就进入下一条链 POSTROUTING。如果目的地非localhost 就跳转到</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ISTIO_REDIRECT；如果流量来自istio-proxy用户空间的，那么就跳出该链，返回它的调用链继续执行下一条规则（OUTPUT</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 的下一条规则，无需对流量进行处理）；所有的非 istio-proxy 用户空间的目的地是localhost 的流量就跳转到</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ISTIO_REDIRECT</span></span><br><span class="line">Chain ISTIO_OUTPUT (1 references)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 ISTIO_REDIRECT  all  --  any    lo      anywhere            !localhost</span><br><span class="line">    2   120 RETURN     all  --  any    any     anywhere             anywhere             owner UID match istio-proxy</span><br><span class="line">    0     0 RETURN     all  --  any    any     anywhere             anywhere             owner GID match istio-proxy</span><br><span class="line">    0     0 RETURN     all  --  any    any     anywhere             localhost</span><br><span class="line">    0     0 ISTIO_REDIRECT  all  --  any    any     anywhere             anywhere</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ISTIO_REDIRECT 链：将所有流量重定向到Envoy（即本地）的15001 端口</span></span><br><span class="line">Chain ISTIO_REDIRECT (2 references)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports 15001</span><br></pre></td></tr></table></figure>

<h4 id="查看-iptables-nat-表中注入的规则"><a href="#查看-iptables-nat-表中注入的规则" class="headerlink" title="查看 iptables nat 表中注入的规则"></a>查看 iptables nat 表中注入的规则</h4><p>init 容器通过向 IPtable nat 表中注入转发规则来劫持流量的，下图显示的是 productpage 服务中 IPtable 流量劫持的详细过程。</p>
<p><img src="https://jimmysong.io/istio-handbook/images/envoy-sidecar-traffic-interception-20190111.png" alt="Envoy Sidecar流量劫持流程示意图"></p>
<p>init 容器启动时命令行参数中指定了 REDIRECT 模式（使用 REDIRECT 动过可以在本机上进行端口映射），因此只创建了 NAT 表规则。上面是查看 nat 表中的规则，其中链的  名字包含 ISTIO 前缀是有 init 容器注入的，规则匹配是根据下面显示的顺序来执行的，其中会有很多跳转。</p>
<h3 id="Sidecar-注入及流量劫持步骤"><a href="#Sidecar-注入及流量劫持步骤" class="headerlink" title="Sidecar 注入及流量劫持步骤"></a>Sidecar 注入及流量劫持步骤</h3><p>下面是 Sidecar 注入、Pod 启动到 Sidecar proxy 拦截流量及 Envoy 处理路由的步骤概览。</p>
<ol>
<li>kubernetes 通过 Admission Controller 自动注入，或者用户使用 istioctl 命令手动注入 Sidecar 容器。</li>
<li>应用 YAML 配置部署应用，此时 Kubernetes API server 接收到服务创建配置文件中  已经包含了 Init 容器  及 Sidecar proxy。</li>
<li>在 Sidecar proxy 容器和应用程序启动之前，首先运行 Init 容器，Init 容器用于设置 IPtables（istio 中默认的流量拦截方式，还可以使用 BPF、IPVS 等方式）将进入 pod 的流量劫持到 Envoy Sidecar proxy。所有的 TCP 流量（Envoy 目前只支持流量）将被 sidecar 劫持，其他不支持协议的流量按原来的目的地请求。</li>
<li>启动 Pod 中的 Envoy Sidecar proxy 和应用程序。</li>
<li>无论是进入还是从 Pod 发出的 TCP 请求都会被 IPtables 劫持，inbound 流量被劫持后进 Inbound Handler 处理后转交给应用容器处理，outbound 流量被 IPtables 劫持后转交给 Outbound Handler 处理，并确定转发的 upstream 和 Endpoint。</li>
<li>Sidecar proxy 请求 Pilot 使用 xDS 协议同步 Envoy 配置，其中包括 LDS、EDS、CDS 等，不过为了保证更新的顺序，Envoy 会直接使用 ADS 向 Pilot 请求配置更新。</li>
</ol>
<h4 id="Inbound-Handler"><a href="#Inbound-Handler" class="headerlink" title="Inbound Handler"></a>Inbound Handler</h4><p>Inbound Handler 的作用是将 IPtables 拦截到的 downstream 的流量转交给 localhost，与 pod 内的应用程序建立连接。</p>
<h4 id="Outbound-Handler"><a href="#Outbound-Handler" class="headerlink" title="Outbound Handler"></a>Outbound Handler</h4><p>Outbound Handler 的作用是将 iptables 拦截到本地应用程序发出的流量，经由 Envoy 判断如何路由到 upstream。</p>
<h3 id="流量转移拆分"><a href="#流量转移拆分" class="headerlink" title="流量转移拆分"></a>流量转移拆分</h3><p>Envoy 的路由器可以跨两个或更多上游集群将流量拆分到虚拟主机中的路由。</p>
<h4 id="在两个上游之间转移流量"><a href="#在两个上游之间转移流量" class="headerlink" title="在两个上游之间转移流量"></a>在两个上游之间转移流量</h4><p>路由配置中的运行时对象判断选择特定路由（以及它的集群）的可能性（可以理解为百分比）。通过使用运行时配置，虚拟主机中到特定路由的流量可逐渐从一个集群转移到另一个集群。按照官方给的示例，reviews 有三个版本，我们先用其中两个版本测试。</p>
<p>全部到 v1 版本的：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VirtualService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">kubectl.kubernetes.io/last-applied-configuration:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      &#123;"apiVersion":"networking.istio.io/v1alpha3","kind":"VirtualService","metadata":&#123;"annotations":&#123;&#125;,"name":"reviews","namespace":"default"&#125;,"spec":&#123;"hosts":["reviews"],"http":[&#123;"route":[&#123;"destination":&#123;"host":"reviews","subset":"v1"&#125;&#125;]&#125;]&#125;&#125;</span></span><br><span class="line"><span class="string"></span><span class="attr">  creationTimestamp:</span> <span class="string">"2019-01-28T22:30:48Z"</span></span><br><span class="line"><span class="attr">  generation:</span> <span class="number">6</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">reviews</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  resourceVersion:</span> <span class="string">"108464"</span></span><br><span class="line"><span class="attr">  selfLink:</span> <span class="string">/apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/reviews</span></span><br><span class="line"><span class="attr">  uid:</span> <span class="number">5</span><span class="string">c1a3e1e-234c-11e9-a865-000c2920f5ac</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  hosts:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">reviews</span></span><br><span class="line"><span class="attr">  http:</span></span><br><span class="line"><span class="attr">    - route:</span></span><br><span class="line"><span class="attr">        - destination:</span></span><br><span class="line"><span class="attr">            host:</span> <span class="string">reviews</span></span><br><span class="line"><span class="attr">            subset:</span> <span class="string">v1</span></span><br></pre></td></tr></table></figure>

<p>在 Envoy 配置中这时并没有设置权重。</p>
<p>30%到 v1 版本，70%到 v3 版本的：(使用 37 分比是为了查看调试方便，也可以使用其他的， 因为配置 json 文件  较大，使用 19 分比可能导致 10 或 90 值  有端口存在，不方便查找)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># istio 看到的配置</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VirtualService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">kubectl.kubernetes.io/last-applied-configuration:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      &#123;"apiVersion":"networking.istio.io/v1alpha3","kind":"VirtualService","metadata":&#123;"annotations":&#123;&#125;,"name":"reviews","namespace":"default"&#125;,"spec":&#123;"hosts":["reviews"],"http":[&#123;"route":[&#123;"destination":&#123;"host":"reviews","subset":"v1"&#125;,"weight":30&#125;,&#123;"destination":&#123;"host":"reviews","subset":"v3"&#125;,"weight":70&#125;]&#125;]&#125;&#125;</span></span><br><span class="line"><span class="string"></span><span class="attr">  creationTimestamp:</span> <span class="string">"2019-01-28T22:30:48Z"</span></span><br><span class="line"><span class="attr">  generation:</span> <span class="number">7</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">reviews</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  resourceVersion:</span> <span class="string">"108818"</span></span><br><span class="line"><span class="attr">  selfLink:</span> <span class="string">/apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/reviews</span></span><br><span class="line"><span class="attr">  uid:</span> <span class="number">5</span><span class="string">c1a3e1e-234c-11e9-a865-000c2920f5ac</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  hosts:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">reviews</span></span><br><span class="line"><span class="attr">  http:</span></span><br><span class="line"><span class="attr">    - route:</span></span><br><span class="line"><span class="attr">        - destination:</span></span><br><span class="line"><span class="attr">            host:</span> <span class="string">reviews</span></span><br><span class="line"><span class="attr">            subset:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">          weight:</span> <span class="number">30</span></span><br><span class="line"><span class="attr">        - destination:</span></span><br><span class="line"><span class="attr">            host:</span> <span class="string">reviews</span></span><br><span class="line"><span class="attr">            subset:</span> <span class="string">v3</span></span><br><span class="line"><span class="attr">          weight:</span> <span class="number">70</span></span><br></pre></td></tr></table></figure>

<p>30%到 v1 版本，70%到 v3 版本的 Envoy 生成的配置(部分)：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">           "prefix": "/"</span><br><span class="line">          &#125;,</span><br><span class="line">          "route": &#123;</span><br><span class="line">           "weighted_clusters": &#123;</span><br><span class="line">            "clusters": [</span><br><span class="line">             &#123;</span><br><span class="line">              <span class="attr">"name"</span>: <span class="string">"outbound|80|v1|reviews.default.svc.cluster.local"</span>,</span><br><span class="line">              <span class="attr">"weight"</span>: <span class="number">30</span>,</span><br><span class="line">              <span class="attr">"per_filter_config"</span>: &#123;</span><br><span class="line">               <span class="attr">"mixer"</span>: &#123;</span><br><span class="line">                <span class="attr">"forward_attributes"</span>: &#123;</span><br><span class="line">--</span><br><span class="line">               &#125;,</span><br><span class="line">             &#123;</span><br><span class="line">              <span class="attr">"name"</span>: <span class="string">"outbound|80|v3|reviews.default.svc.cluster.local"</span>,</span><br><span class="line">              <span class="attr">"weight"</span>: <span class="number">70</span>,</span><br><span class="line">              <span class="attr">"per_filter_config"</span>: &#123;</span><br><span class="line">               <span class="attr">"mixer"</span>: &#123;</span><br><span class="line">                <span class="attr">"forward_attributes"</span>: &#123;</span><br><span class="line">--</span><br><span class="line">             "prefix": "/"</span><br><span class="line">          &#125;,</span><br><span class="line">          "route": &#123;</span><br><span class="line">           "weighted_clusters": &#123;</span><br><span class="line">            "clusters": [</span><br><span class="line">             &#123;</span><br><span class="line">              <span class="attr">"name"</span>: <span class="string">"outbound|9080|v1|reviews.default.svc.cluster.local"</span>,</span><br><span class="line">              <span class="attr">"weight"</span>: <span class="number">30</span>,</span><br><span class="line">              <span class="attr">"per_filter_config"</span>: &#123;</span><br><span class="line">               <span class="attr">"mixer"</span>: &#123;</span><br><span class="line">                <span class="attr">"mixer_attributes"</span>: &#123;</span><br><span class="line">--</span><br><span class="line">               &#125;,</span><br><span class="line">             &#123;</span><br><span class="line">              <span class="attr">"name"</span>: <span class="string">"outbound|9080|v3|reviews.default.svc.cluster.local"</span>,</span><br><span class="line">              <span class="attr">"weight"</span>: <span class="number">70</span>,</span><br><span class="line">              <span class="attr">"per_filter_config"</span>: &#123;</span><br><span class="line">               <span class="attr">"mixer"</span>: &#123;</span><br><span class="line">                <span class="attr">"mixer_attributes"</span>: &#123;</span><br></pre></td></tr></table></figure>

<p>Envoy 使用 first Match 策略来匹配路由。如果路由具有运行对象，则会根据运行时值另外匹配请求（如果未指定值，则为默认值）。因此通过在上述示例中背靠背地放置路由并在第一个路由中指定运行时对象，可以通过更改运行时  值来完成流量转移。</p>
<p>默认情况下，权重的总和必须  精确地为 100。在 v2 API 中，总权重默认为 100，但是可以修改以允许更精确的粒度。</p>
<p>Envoy 大致  配置文件 JSON 结构：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"configs"</span>: &#123;</span><br><span class="line">        "listeners": &#123;...&#125;,</span><br><span class="line">        "clusters": &#123;...&#125;,</span><br><span class="line">        "bootstrap": &#123;...&#125;,</span><br><span class="line">        "routes": &#123;</span><br><span class="line">            "@type": "type.googleapis.com/envoy.admin.v2alpha.RoutesConfigDump",</span><br><span class="line">            "static_route_configs": &#123;...&#125;,</span><br><span class="line">            "dynamic_route_configs": &#123;...&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="运维管理"><a href="#运维管理" class="headerlink" title="运维管理"></a>运维管理</h3><h3 id="调试-Envoy-和-Pilot"><a href="#调试-Envoy-和-Pilot" class="headerlink" title="调试 Envoy 和 Pilot"></a>调试 Envoy 和 Pilot</h3><p>proxy-status 命令允许获取网格的概述并识别导致问题的代理。然后 proxy-status 可以用来检查 Envoy 配置并诊断问题。</p>
<h4 id="了解服务网格概况"><a href="#了解服务网格概况" class="headerlink" title="了解服务网格概况"></a>了解服务网格概况</h4><p>proxy-status 命令允许获取网格的状态。如果怀疑其中一个 sidecar 没有收到配置或者不同步，那么代理状态会通知你。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果此列表中缺少代理，则表示它当前未连接到 Pilot 实例，因此不会接受任何配置。</p>
<ul>
<li>SYNCED 表示 Envoy 已经确认了 Pilot 上次发送给它的实例。</li>
<li>SYNCED(100%) 表示 Envoy 已经成功同步了集群中的所有端点。</li>
<li>NOT SENT 表示 Pilot 没有发送任何消息给 Envoy。这通常是因为 Pilot 没有任何数据可以发送。</li>
<li>STALE 表示 Pilot 已向 Envoy 发送更新但尚未收到确认。这通常表明 Envoy 和 Pilot 之间的网络存在问题或者 Istio 本身的错误。</li>
</ul>
<h3 id="关于-Envoy-性能优化"><a href="#关于-Envoy-性能优化" class="headerlink" title="关于 Envoy 性能优化"></a>关于 Envoy 性能优化</h3><ul>
<li><a href="https://yq.aliyun.com/articles/606655" target="_blank" rel="noopener">浅谈 Service Mesh 体系中的 Envoy</a></li>
<li><a href="https://jimmysong.io/kubernetes-handbook/concepts/cilium.html" target="_blank" rel="noopener">具备 API 感知的网络和安全性管理的开源软件 Cilium</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/linux/l-lo-eBPF-history/index.html" target="_blank" rel="noopener">eBPF 简史</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ibumblebee.github.io/2019/08/05/Office365-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="IBUMBLEBEE">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IBUMBLEBEE 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/05/Office365-install/" itemprop="url">Office365 安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-05T23:32:21+08:00">
                2019-08-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="关于Office-365-安装步骤"><a href="#关于Office-365-安装步骤" class="headerlink" title="关于Office 365 安装步骤"></a>关于Office 365 安装步骤</h2><h3 id="手工修改配置文件方法"><a href="#手工修改配置文件方法" class="headerlink" title="手工修改配置文件方法"></a>手工修改配置文件方法</h3><ol>
<li>将office365 离线安装包解压并拷贝至磁盘剩余较多的目录（不一定要是C盘，现在的Office365 安装；路径默认C盘，并且不可选择）。</li>
<li>选择对应操作系统x86和x64系统对应安装包的目录，找到对应的配置文件 <code>configuration-Office365-x64.xml</code>（如 64位系统的安装目录）。</li>
<li>用记事本或者可以打开该文件的编辑器打开，找到对应的XML 节点属性值 SourcePath，对应该值和该配置文件所在的目录是否一致（复制当前目录路径方法：选中文件夹导航路径，全选复制）</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SourcePath=&quot;D:\xxx\Office 365&quot;</span><br></pre></td></tr></table></figure>

<p>如果值不一致，则修改成对应的路径，一致则不需要修改。为防止安装的时候报错，在SourcePath同一节点的属性内加一个值 </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AllowCdnFallback="True"</span><br></pre></td></tr></table></figure>

<p>配置完成以后的配置文件类似如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Office 365 client configuration file sample. To be used for Office 365 ProPlus apps, </span></span><br><span class="line"><span class="comment">     Office 365 Business apps, Project Pro for Office 365 and Visio Pro for Office 365. </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     For detailed information regarding configuration options visit: http://aka.ms/ODT. </span></span><br><span class="line"><span class="comment">     To use the configuration file be sure to remove the comments</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     The following sample allows you to download and install the 64 bit version of the Office 365 ProPlus apps </span></span><br><span class="line"><span class="comment">     and Visio Pro for Office 365 directly from the Office CDN using the Monthly Channel</span></span><br><span class="line"><span class="comment">     settings  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Add</span> <span class="attr">SourcePath</span>=<span class="string">"G:\GitHub\Code\pycode"</span> <span class="attr">OfficeClientEdition</span>=<span class="string">"64"</span> <span class="attr">Channel</span>=<span class="string">"Monthly"</span> <span class="attr">AllowCdnFallback</span>=<span class="string">"True"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Product</span> <span class="attr">ID</span>=<span class="string">"O365ProPlusRetail"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Language</span> <span class="attr">ID</span>=<span class="string">"zh-cn"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Product</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Add</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  &lt;Updates Enabled="TRUE" Channel="Monthly" /&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Display</span> <span class="attr">Level</span>=<span class="string">"Full"</span> <span class="attr">AcceptEULA</span>=<span class="string">"TRUE"</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  &lt;Property Name="AUTOACTIVATE" Value="1" /&gt;  --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>保存关闭编辑器。</p>
<ol start="4">
<li>双击setup.dat安装文件开始安装office365。</li>
</ol>
<h3 id="脚本安装方法（PowerShell-更麻烦）"><a href="#脚本安装方法（PowerShell-更麻烦）" class="headerlink" title="脚本安装方法（PowerShell 更麻烦）"></a>脚本安装方法（PowerShell 更麻烦）</h3><ol>
<li><p>将 <code>WindowsPowerShell.ps1</code> 文件拷贝至 Office 365 源目录下，与 <code>configuration-Office365-x86.xml</code> 类似文件同一目录</p>
</li>
<li><p>找到 Windows 系统的 PowerShell 程序（Windows 10 在左下角搜索程序，Windows7在开始 -&gt;附件 -&gt; PowerShell）</p>
</li>
<li><p>选中右键以管理员身份运行PowerShell，输入 （允许运行pwsh 脚本）</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> UnRestricted</span><br></pre></td></tr></table></figure>

<p>回车确认按提示操作（请勿关闭此窗口，后面还会使用）</p>
<ol start="4">
<li><p>找到 ·<code>WindowsPowershell.ps1</code> 文件，选中右键以 PowerShell 运行，等待返回结果</p>
</li>
<li><p>如果没有报错或者显示红色，即配置文件修改成功（如果报错，请联系你的男朋友，他会帮你解决问题）</p>
</li>
<li><p>关闭系统运行 ps1 文件权限，在之前打开的 PowerShell 终端输入 (默认关闭不可执行PowerShell)</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Restricted</span><br></pre></td></tr></table></figure>

<p>回车运行按提示操作</p>
<ol start="7">
<li>双击 office 365 <code>setup.bat</code>，开始安装office 365，等待安装完成</li>
</ol>
<p>下面是 <code>PowerShell</code> 脚本(可粘贴复制 <code>WindowsPowershell.ps1</code>，脚本兼容 <code>Windows7 PowerShell 2.0</code> 和 <code>Windows10 PowerShell 5.0</code>)：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#powershell</span></span><br><span class="line"><span class="variable">$pwshversion</span> = <span class="variable">$host</span>.version.Major</span><br><span class="line"><span class="variable">$officepwd</span> = (<span class="variable">$pwd</span>).Path</span><br><span class="line"><span class="variable">$filenamex86</span> = <span class="string">"configuration-Office365-x86.xml"</span></span><br><span class="line"><span class="variable">$filenamex86_bak</span> = <span class="string">"bak_configuration-Office365-x86.xml"</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$filenamex64</span> = <span class="string">"configuration-Office365-x64.xml"</span></span><br><span class="line"><span class="variable">$filenamex64_bak</span> = <span class="string">"bak_configuration-Office365-x64.xml"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$file</span> <span class="keyword">in</span> (dir *.xml)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file</span>.Name <span class="nomarkup">-eq</span> <span class="variable">$filenamex86</span>) &#123;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="variable">$filenamex86</span></span><br><span class="line">        <span class="variable">$filename_bak</span> = <span class="variable">$filenamex86_bak</span> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="variable">$filenamex64</span></span><br><span class="line">        <span class="variable">$filename_bak</span> = <span class="variable">$filenamex64_bak</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># for windows7 and powershell 2.0</span></span><br><span class="line"><span class="keyword">function</span> pwshversion2 &#123;</span><br><span class="line">    <span class="string">"hello Powershell 2.0"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Test-Path</span> -Path <span class="variable">$filename</span>) &#123;</span><br><span class="line">        <span class="string">"Office 365 SourcePath Checked ------ Ok"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="string">"Office 365 SourcePath Checked ------ ERROR"</span></span><br><span class="line">        <span class="string">"Enter to exit"</span></span><br><span class="line">        cmd /c pause | <span class="built_in">out-null</span></span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Test-Path</span> -Path <span class="variable">$filename_bak</span>) &#123;</span><br><span class="line">        <span class="string">"Backup File Checked ------ Warning"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Copy-Item</span> <span class="variable">$filename</span> <span class="variable">$filename_bak</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Test-Path</span> -Path <span class="variable">$filename_bak</span>) &#123;</span><br><span class="line">            <span class="string">"Backup File Successfully ------ Ok"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="string">"Backup File Checked ------ Warning"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$xmldoc</span> = [xml](<span class="built_in">Get-Content</span> <span class="variable">$filename</span>)</span><br><span class="line">    <span class="variable">$docnodes</span> = <span class="variable">$xmldoc</span>.SelectNodes(<span class="string">"Configuration/Add"</span>)</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$docnode</span> <span class="keyword">in</span> <span class="variable">$docnodes</span>) &#123;</span><br><span class="line">        <span class="variable">$docnode</span>.SetAttribute(<span class="string">"SourcePath"</span>, <span class="variable">$officepwd</span>)</span><br><span class="line">        <span class="variable">$docnode</span>.SetAttribute(<span class="string">"AllowCdnFallback"</span>, <span class="string">"True"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$xmldoc</span>.Configuration.Add</span><br><span class="line">    <span class="variable">$xmldoc</span>.Save((<span class="built_in">Resolve-Path</span> <span class="variable">$filename</span>))</span><br><span class="line">    <span class="string">"The configruration file was successfully modified!!! ------ OK"</span></span><br><span class="line">    <span class="string">"Please run setup.bat ------ GOTO"</span></span><br><span class="line">    <span class="string">"Enter to exit"</span></span><br><span class="line">    <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    cmd /c pause | <span class="built_in">out-null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># for windows10 and powershell 5.0</span></span><br><span class="line"><span class="keyword">function</span> pwshversion5() &#123;</span><br><span class="line">    <span class="string">"hello Powershell 5.0"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># $specialCharl = [char] 0x25ba</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Test-Path</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">        <span class="comment"># Write-Host 'Checked' -NoNewline</span></span><br><span class="line">        <span class="comment"># Write-Host $specialCharl -ForegroundColor Green -NoNewline</span></span><br><span class="line">        <span class="string">"Office 365 SourcePath Checked ------ Ok"</span> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="string">"Office 365 SourcePath Checked ------ ERROR"</span></span><br><span class="line">        <span class="string">"Enter to exit"</span></span><br><span class="line">        pause</span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Test-Path</span> <span class="variable">$filename_bak</span>) &#123;</span><br><span class="line">        <span class="string">"Backup File Checked ------ Warning"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Copy-Item</span> <span class="variable">$filename</span> <span class="variable">$filename_bak</span></span><br><span class="line">        <span class="string">"Backup File Successfully ------ Ok"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$xmldata</span> = [xml](<span class="built_in">Get-Content</span> <span class="variable">$filename</span>)</span><br><span class="line"></span><br><span class="line">    <span class="variable">$nodes</span> = <span class="variable">$xmldata</span>.SelectNodes(<span class="string">"Configuration/Add"</span>)</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$node</span> <span class="keyword">in</span> <span class="variable">$nodes</span>) &#123;</span><br><span class="line">        <span class="variable">$node</span>.SetAttribute(<span class="string">"SourcePath"</span>, <span class="variable">$officepwd</span>)</span><br><span class="line">        <span class="variable">$node</span>.SetAttribute(<span class="string">"AllowCdnFallback"</span>, <span class="string">"True"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$xmldata</span>.Configuration.Add</span><br><span class="line">    <span class="variable">$xmldata</span>.Save(<span class="variable">$filename</span>)</span><br><span class="line">    <span class="string">"The configruration file was successfully modified!!! ------ OK"</span></span><br><span class="line">    <span class="string">"Please run setup.bat ------ GOTO"</span></span><br><span class="line">    <span class="string">"Enter to exit"</span></span><br><span class="line">    <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    Pause</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$pwshversion</span> <span class="nomarkup">-eq</span> <span class="number">5</span>) &#123;</span><br><span class="line">    pwshversion5</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (<span class="variable">$pwshversion</span> <span class="nomarkup">-eq</span> <span class="number">2</span>) &#123;</span><br><span class="line">    pwshversion2</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="string">"Powershell version not support"</span></span><br><span class="line">    <span class="string">"Enter to exit"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>备注：本教程不提供 Office 365 下载包，可自行网络查找</p>
<p>新手入门，请多指教</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ibumblebee.github.io/2019/08/05/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="IBUMBLEBEE">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IBUMBLEBEE 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/05/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-05T23:04:33+08:00">
                2019-08-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="IBUMBLEBEE">
          <p class="site-author-name" itemprop="name">IBUMBLEBEE</p>
           
              <p class="site-description motion-element" itemprop="description">学无止境</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">IBUMBLEBEE</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
