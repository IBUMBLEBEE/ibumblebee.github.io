<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-cn">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="Centos Caffe 部署前置条件 Centos 7 OpenCV 3.3.1 Cmake-3.15.1 Python 2.7.5 virtualenv 虚拟环境  编译 OpenCV安装依赖包12345678910111213141516sudo yum -y install epel-release \            git wget unzip gcc gcc-c++ cmake">
<meta name="keywords" content="DevOps">
<meta property="og:type" content="article">
<meta property="og:title" content="在Centos7和Ubuntu上部署Caffe">
<meta property="og:url" content="https://ibumblebee.github.io/2019/08/08/在Centos7和Ubuntu上部署Caffe/index.html">
<meta property="og:site_name" content="IBUMBLEBEE 博客">
<meta property="og:description" content="Centos Caffe 部署前置条件 Centos 7 OpenCV 3.3.1 Cmake-3.15.1 Python 2.7.5 virtualenv 虚拟环境  编译 OpenCV安装依赖包12345678910111213141516sudo yum -y install epel-release \            git wget unzip gcc gcc-c++ cmake">
<meta property="og:locale" content="zh-cn">
<meta property="og:updated_time" content="2019-08-08T07:12:04.712Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="在Centos7和Ubuntu上部署Caffe">
<meta name="twitter:description" content="Centos Caffe 部署前置条件 Centos 7 OpenCV 3.3.1 Cmake-3.15.1 Python 2.7.5 virtualenv 虚拟环境  编译 OpenCV安装依赖包12345678910111213141516sudo yum -y install epel-release \            git wget unzip gcc gcc-c++ cmake">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ibumblebee.github.io/2019/08/08/在Centos7和Ubuntu上部署Caffe/">





  <title>在Centos7和Ubuntu上部署Caffe | IBUMBLEBEE 博客</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-cn">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">IBUMBLEBEE 博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">读过两年书，尘世中一个迷途小书童</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ibumblebee.github.io/2019/08/08/在Centos7和Ubuntu上部署Caffe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="IBUMBLEBEE">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IBUMBLEBEE 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">在Centos7和Ubuntu上部署Caffe</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-08T15:10:09+08:00">
                2019-08-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Centos-Caffe-部署"><a href="#Centos-Caffe-部署" class="headerlink" title="Centos Caffe 部署"></a>Centos Caffe 部署</h2><h3 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h3><ul>
<li>Centos 7</li>
<li>OpenCV 3.3.1</li>
<li>Cmake-3.15.1</li>
<li>Python 2.7.5</li>
<li>virtualenv 虚拟环境</li>
</ul>
<h3 id="编译-OpenCV"><a href="#编译-OpenCV" class="headerlink" title="编译 OpenCV"></a>编译 OpenCV</h3><h4 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install epel-release \</span><br><span class="line">            git wget unzip gcc gcc-c++ cmake cmake3 \</span><br><span class="line">            qt5-qtbase-devel \</span><br><span class="line">            python python-devel python-pip \</span><br><span class="line">            gtk2-devel \</span><br><span class="line">            libpng-devel \</span><br><span class="line">            jasper-devel \</span><br><span class="line">            openexr-devel \</span><br><span class="line">            libwebp-devel \</span><br><span class="line">            libjpeg-turbo-devel \</span><br><span class="line">            freeglut-devel mesa-libGL mesa-libGL-devel \</span><br><span class="line">            libtiff-devel \</span><br><span class="line">            libdc1394-devel \</span><br><span class="line">            tbb-devel eigen3-devel \</span><br><span class="line">            libv4l-devel \</span><br><span class="line">            gstreamer-plugins-base-devel</span><br></pre></td></tr></table></figure>

<h4 id="安装-ffmpeg"><a href="#安装-ffmpeg" class="headerlink" title="安装 ffmpeg"></a>安装 ffmpeg</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y epel-release</span><br><span class="line">rpm -v --import http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro</span><br><span class="line">rpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm</span><br><span class="line">yum install -y ffmpeg ffmpeg-devel</span><br><span class="line">ffmpeg -version</span><br></pre></td></tr></table></figure>

<h4 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv virtualenvwrapper -i https://pypi.doubanio.com/simple/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里注意使用Python2和Python3</span></span><br><span class="line">echo "export WORKON_HOME=/root/.virtualenvs" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "source /usr/bin/virtualenvwrapper.sh" &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br><span class="line">mkvirtualenv OpenCV-3.3.1-py2 -p python</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下次进入的时候使用</span></span><br><span class="line">workon OpenCV-3.3.1-py2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 阿里云服务器默认选用阿里源，可取消 -i 参数</span></span><br><span class="line">pip install cmake -i https://pypi.doubanio.com/simple/</span><br><span class="line">pip install numpy==1.11.0 scipy==0.17.0 matplotlib==2.1.1 scikit-image==0.13.1  ipython==5.5 scikit-learn dlib -i https://pypi.doubanio.com/simple/</span><br></pre></td></tr></table></figure>

<h4 id="OpenCV-编译安装"><a href="#OpenCV-编译安装" class="headerlink" title="OpenCV 编译安装"></a>OpenCV 编译安装</h4><p>OpenCV 安装版本选择是根据 anaconda 安装 Caffe 时，依赖安装的是 OpenCV-3.3.1。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载对应版本的OpenCV，并解压</span></span><br><span class="line"></span><br><span class="line">mkdir /opt/opencv_3rdparty</span><br><span class="line">cd /opt/opencv_3rdparty</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载编译OpenCV时需要的依赖</span></span><br><span class="line"></span><br><span class="line">sed -i 's/https:\/\/raw.githubusercontent.com\/opencv\/opencv_3rdparty\/\$&#123;IPPICV_COMMIT&#125;\/ippicv\//file:\/\/\/opt\/opencv_3rdparty\//g' ./opencv-3.3.1/3rdparty/ippicv/ippicv.cmake</span><br><span class="line"></span><br><span class="line">export ENV_OPENCV_PY=/root/.virtualenvs/OpenCV-3.3.1-py2</span><br><span class="line">cd opencv-3.3.1 &amp;&amp; mkdir build &amp;&amp; cd build</span><br><span class="line"><span class="meta">#</span><span class="bash"> CMAKE_INSTALL_PREFIX 安装路径，这个一般指定Python模块安装路径的lib上层。当然还可以指定别的路径，注意加载环境变量。在虚拟环境中，直接是家目录。该包生成的Python模块是标准的，可以直接指定Python包安装路径。如果安装错误也没关系，可以使用软链接方式，具体方式请自行网上查找。</span></span><br><span class="line">cmake -D CMAKE_BUILD_TYPE=Release \</span><br><span class="line">      -D WITH_FFMPEG=ON \</span><br><span class="line">      -D CMAKE_INSTALL_PREFIX=$ENV_OPENCV_PY \</span><br><span class="line">      -D PYTHON_EXECUTABLE=$ENV_OPENCV_PY/bin/python \</span><br><span class="line">      -D PYTHON_INCLUDE_DIR=$ENV_OPENCV_PY/include/python2.7 \</span><br><span class="line">      -D PYTHON_LIBRARY=$ENV_OPENCV_PY/lib/python2.7/config/libpython2.7.so \</span><br><span class="line">      -D PYTHON_NUMPY_INCLUDE_DIRS=$ENV_OPENCV_PY/lib/python2.7/site-packages/numpy/core/include/ ..</span><br><span class="line"></span><br><span class="line">make -j$(nproc)</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试生成的Python 模块</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;import cv2</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;import os.path.dirname(os.__file__)</span></span><br></pre></td></tr></table></figure>

<h3 id="编译-Caffe"><a href="#编译-Caffe" class="headerlink" title="编译 Caffe"></a>编译 Caffe</h3><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><p>按照官网要求，安装 boost-devel 开发包时会安装依赖包 boost-1.53，该版本过低，暂不安装。</p>
<h4 id="编译安装-Boost-1-58-（Caffe-编译需要依赖这个-C-库，版本-1-55-以上）"><a href="#编译安装-Boost-1-58-（Caffe-编译需要依赖这个-C-库，版本-1-55-以上）" class="headerlink" title="编译安装 Boost-1.58 （Caffe 编译需要依赖这个 C++库，版本 1.55 以上）"></a>编译安装 Boost-1.58 （Caffe 编译需要依赖这个 C++库，版本 1.55 以上）</h4><p>由于 Centos yum 安装是 Boost-1.53 版本，不符合要求。需要编译安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc-c++ python-devel bzip2-devel zlib-devel</span><br><span class="line">wget https://nchc.dl.sourceforge.net/project/boost/boost/1.58.0/boost_1_58_0.zip</span><br><span class="line">unzip boost_1_58_0.zip</span><br><span class="line">cd boost_1_58_0 &amp;&amp; ./bootstrap.sh --prefix=/usr/local/boost</span><br><span class="line">./b2</span><br><span class="line">cd tools/build &amp;&amp; ./bootstrap.sh</span><br><span class="line">./b2 install --prefix=/usr/local/boost</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">yum install -y protobuf-devel leveldb-devel snappy-devel hdf5-devel</span><br><span class="line"></span><br><span class="line">pip install protobuf -i https://pypi.doubanio.com/simple/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> glog 请注意，glog不能使用最新的gflags版本（2.1）进行编译，因此在解决之前，您需要先使用glog进行构建。</span></span><br><span class="line">wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/google-glog/glog-0.3.3.tar.gz</span><br><span class="line">tar zxvf glog-0.3.3.tar.gz</span><br><span class="line">cd glog-0.3.3</span><br><span class="line">./configure</span><br><span class="line">make -j$(nproc) &amp;&amp; make install</span><br><span class="line"><span class="meta">#</span><span class="bash"> gflags</span></span><br><span class="line">wget https://github.com/schuhschuh/gflags/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line">cd gflags-master</span><br><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line">export CXXFLAGS="-fPIC" &amp;&amp; cmake .. &amp;&amp; make VERBOSE=1</span><br><span class="line">make -j$(nproc) &amp;&amp; make install</span><br><span class="line"><span class="meta">#</span><span class="bash"> lmdb</span></span><br><span class="line">git clone https://github.com/LMDB/lmdb</span><br><span class="line">cd lmdb/libraries/liblmdb</span><br><span class="line">make -j$(nproc) &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为获得更好的CPU 性能</span></span><br><span class="line">yum install -y atlas-devel</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用cmake 编译</span></span><br><span class="line">git clone https://github.com/BVLC/caffe.git</span><br><span class="line">cd caffe</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改编译配置</span></span><br><span class="line">cp Makefile.config.example Makefile.config</span><br><span class="line"><span class="meta">#</span><span class="bash"> CPU_ONLY=1 仅仅 CPU 模式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS := atlas  CPU更好性能</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_INCLUDE := /usr/include/atlas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_LIB := /usr/lib64/atlas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Python库相关路径配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_INCLUDE，PYTHON_LIB</span></span><br><span class="line"></span><br><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 该文档只是使用cmake编译，make编译尚未验证。cmake编译时需要atlas相关的动态库，不然编译时会报错找不到Atlas_CBLAS_LIBRARY,Atlas_BLAS_LIBRARY,Atlas_LAPACK_LIBRARY 库。cmake 编译的Makefile在Caffe源码目录下<span class="variable">$CAFFE_ROOT</span>/cmake/Modules/FindAtlas.cmake</span></span><br><span class="line">ln -sv /usr/lib64/atlas/libsatlas.so.3.10 /usr/lib64/atlas/libcblas.so</span><br><span class="line">ln -sv /usr/lib64/atlas/libsatlas.so.3.10 /usr/lib64/atlas/libatlas.so</span><br><span class="line">ln -sv /usr/lib64/atlas/libsatlas.so.3.10 /usr/lib64/atlas/liblapack.so</span><br><span class="line"></span><br><span class="line">cmake ..</span><br><span class="line">make -j$(nproc) all</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里编译完成之后，会有相关的设置环境变量提示，注意保存并添加环境变量。</span></span><br><span class="line">make -j$(nproc) install</span><br><span class="line">make -j$(nproc) runtest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置环境变量到~/.bashrc，注意是虚拟环境的家目录。</span></span><br><span class="line">export CAFFE_ROOT=/opt/caffe-1.0</span><br><span class="line">export PYCAFFE_ROOT=$CAFFE_ROOT/build/install/python</span><br><span class="line">export PYTHONPATH=$PYCAFFE_ROOT:$PYTHONPATH</span><br><span class="line">export PATH=$CAFFE_ROOT/build/tools:$PYCAFFE_ROOT:$CAFFE_ROOT/build/install/lib:/opt/boost_1_58_0/stage/lib:$WORKON_HOME/OpenCV-3.3.1-py2/lib:/usr/local/lib:/usr/lib64/atlas:$CAFFE_ROOT/build/install/python/caffe/_caffe.so:$PATH</span><br><span class="line"></span><br><span class="line">source ~/.bashrc</span><br><span class="line"></span><br><span class="line">echo /opt/caffe-1.0/build/lib &gt; /etc/ld.so.conf.d/caffe.conf</span><br><span class="line">ldconfig</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试caffe</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;import caffe</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;import os</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;<span class="built_in">print</span> os.path.dirname(caffe.__file__)</span></span><br></pre></td></tr></table></figure>

<h2 id="Ubuntu-Caffe-OpenCV-安装部署"><a href="#Ubuntu-Caffe-OpenCV-安装部署" class="headerlink" title="Ubuntu Caffe OpenCV 安装部署"></a>Ubuntu Caffe OpenCV 安装部署</h2><h3 id="前置条件-1"><a href="#前置条件-1" class="headerlink" title="前置条件"></a>前置条件</h3><ul>
<li>Ubuntu 16.04</li>
<li>OpenCV 3.3.1</li>
<li>Cmake-3.15.1</li>
<li>Python 2.7.12</li>
</ul>
<h3 id="编译-OpenCV-1"><a href="#编译-OpenCV-1" class="headerlink" title="编译 OpenCV"></a>编译 OpenCV</h3><h4 id="安装依赖包-1"><a href="#安装依赖包-1" class="headerlink" title="安装依赖包"></a>安装依赖包</h4><p>安装 Python 以及 OpenCV 安装所需的其他库和包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install cmake</span><br><span class="line">sudo apt-get install build-essential \</span><br><span class="line">             libgtk2.0-dev \</span><br><span class="line">             libavcodec-dev \</span><br><span class="line">             libavformat-dev \</span><br><span class="line">             libjpeg.dev \</span><br><span class="line">             libtiff4.dev \</span><br><span class="line">             libswscale-dev \</span><br><span class="line">             libjasper-dev</span><br></pre></td></tr></table></figure>

<h4 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这里的包版本是按照项目Python包的具体版本安装的，不是必须这样的。只需要满足条件即可。</span></span><br><span class="line">pip install numpy==1.11.0 scipy==0.17.0 matplotlib==2.1.1 scikit-image==0.13.1  ipython==5.5 scikit-learn dlib</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改编译安装下载依赖</span></span><br><span class="line">mkdir /opt/opencv_3rdparty</span><br><span class="line">cd /opt/opencv_3rdparty</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/ippicv/master_20180723/ippicv/ippicv_2019_lnx_intel64_general_20180723.tgz</span><br><span class="line"></span><br><span class="line">wget https://github.com/opencv/opencv/archive/opencv-3.3.1.zip</span><br><span class="line">unzip opencv-3.3.1.zip</span><br><span class="line">cd opencv-3.3.1</span><br><span class="line">sed -i 's/https:\/\/raw.githubusercontent.com\/opencv\/opencv_3rdparty\/\$&#123;IPPICV_COMMIT&#125;\/ippicv\//file:\/\/\/opt\/opencv_3rdparty\//g' ./opencv-3.3.1/3rdparty/ippicv/ippicv.cmake</span><br><span class="line"></span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意修改对应路径地址 python 路径，有可能是虚拟环境的</span></span><br><span class="line">cmake -D CMAKE_BUILD_TYPE=Release \</span><br><span class="line">      -D WITH_FFMPEG=ON \</span><br><span class="line">      -D CMAKE_INSTALL_PREFIX=/usr/local \</span><br><span class="line">      -D OPENCV_PYTHON2_INSTALL_PATH=/usr/local/lib/python2.7/dist-packages/ \</span><br><span class="line">      -D PYTHON_EXECUTABLE=/usr/bin/python \</span><br><span class="line">      -D PYTHON_INCLUDE_DIR=/usr/include/python2.7 \</span><br><span class="line">      -D PYTHON_INCLUDE_DIR2=/usr/include/x86_64-linux-gnu/python2.7 \</span><br><span class="line">      -D PYTHON_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython2.7.so \</span><br><span class="line">      -D PYTHON_INCLUDE_DIRS=/usr/local/lib/python2.7/dist-packages/numpy/core/include/ ..</span><br><span class="line"></span><br><span class="line">make -j$(nproc)</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="测试-OpenCV-Python-模块"><a href="#测试-OpenCV-Python-模块" class="headerlink" title="测试 OpenCV Python 模块"></a>测试 OpenCV Python 模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">print</span> cv2.__version__</span><br><span class="line"><span class="number">3.3</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h3 id="编译-Caffe-1"><a href="#编译-Caffe-1" class="headerlink" title="编译 Caffe"></a>编译 Caffe</h3><h4 id="通用依赖"><a href="#通用依赖" class="headerlink" title="通用依赖"></a>通用依赖</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; apt-get install -y --no-install-recommends \</span><br><span class="line">        build-essential \</span><br><span class="line">        cmake \</span><br><span class="line">        git \</span><br><span class="line">        wget \</span><br><span class="line">        libatlas-base-dev \</span><br><span class="line">        libboost-all-dev \</span><br><span class="line">        libgflags-dev \</span><br><span class="line">        libgoogle-glog-dev \</span><br><span class="line">        libhdf5-serial-dev \</span><br><span class="line">        libleveldb-dev \</span><br><span class="line">        liblmdb-dev \</span><br><span class="line">        libopencv-dev \</span><br><span class="line">        libprotobuf-dev \</span><br><span class="line">        libsnappy-dev \</span><br><span class="line">        protobuf-compiler \</span><br><span class="line">        python-dev \</span><br><span class="line">        python-numpy \</span><br><span class="line">        python-pip \</span><br><span class="line">        python-setuptools \</span><br><span class="line">        python-scipy</span><br></pre></td></tr></table></figure>

<h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载源码 解压</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装编译依赖的Python，在caffe 源码包Python目录下，尽量安装项目依赖的包的具体版本安装，只要满足python目录下包版本需求即可。</span></span><br><span class="line"></span><br><span class="line">cd python &amp;&amp; for req in $(cat requirements.txt); do pip install $req; done &amp;&amp; cd ..</span><br><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 仅CPU加速</span></span><br><span class="line">cmake -D CPU_ONLY=1 ..</span><br><span class="line">make -j$(nproc)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置Caffe Python包环境变量</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Caffe 源码包路径视情况而定</span></span><br><span class="line">echo "export CAFFE_ROOT=/opt/download/caffe-1.0" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "export PYCAFFE_ROOT=$CAFFE_ROOT/python" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "export PYTHONPATH=$PYCAFFE_ROOT:$PYTHONPATH" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "export PATH=$CAFFE_ROOT/build/tools:$PYCAFFE_ROOT:$PATH" &gt;&gt; ~/.bashrc</span><br><span class="line">echo "$CAFFE_ROOT/build/lib" &gt;&gt; /etc/ld.so.conf.d/caffe.conf &amp;&amp; ldconfig</span><br><span class="line"></span><br><span class="line">source ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试Caffe 包是否可用</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;import caffe</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;<span class="built_in">print</span> caffe.__version__</span></span><br><span class="line">1.0.0</span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/08/06/istio-组件之-Pilot/" rel="next" title="istio 组件之 Pilot">
                <i class="fa fa-chevron-left"></i> istio 组件之 Pilot
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/09/12/Python-面向对象编程/" rel="prev" title="Python 面向对象编程">
                Python 面向对象编程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="IBUMBLEBEE">
          <p class="site-author-name" itemprop="name">IBUMBLEBEE</p>
           
              <p class="site-description motion-element" itemprop="description">学无止境</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Centos-Caffe-部署"><span class="nav-number">1.</span> <span class="nav-text">Centos Caffe 部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前置条件"><span class="nav-number">1.1.</span> <span class="nav-text">前置条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译-OpenCV"><span class="nav-number">1.2.</span> <span class="nav-text">编译 OpenCV</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装依赖包"><span class="nav-number">1.2.1.</span> <span class="nav-text">安装依赖包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装-ffmpeg"><span class="nav-number">1.2.2.</span> <span class="nav-text">安装 ffmpeg</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建虚拟环境"><span class="nav-number">1.2.3.</span> <span class="nav-text">创建虚拟环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OpenCV-编译安装"><span class="nav-number">1.2.4.</span> <span class="nav-text">OpenCV 编译安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译-Caffe"><span class="nav-number">1.3.</span> <span class="nav-text">编译 Caffe</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装依赖"><span class="nav-number">1.3.1.</span> <span class="nav-text">安装依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编译安装-Boost-1-58-（Caffe-编译需要依赖这个-C-库，版本-1-55-以上）"><span class="nav-number">1.3.2.</span> <span class="nav-text">编译安装 Boost-1.58 （Caffe 编译需要依赖这个 C++库，版本 1.55 以上）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ubuntu-Caffe-OpenCV-安装部署"><span class="nav-number">2.</span> <span class="nav-text">Ubuntu Caffe OpenCV 安装部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前置条件-1"><span class="nav-number">2.1.</span> <span class="nav-text">前置条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译-OpenCV-1"><span class="nav-number">2.2.</span> <span class="nav-text">编译 OpenCV</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装依赖包-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">安装依赖包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#开始安装"><span class="nav-number">2.2.2.</span> <span class="nav-text">开始安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#测试-OpenCV-Python-模块"><span class="nav-number">2.2.3.</span> <span class="nav-text">测试 OpenCV Python 模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译-Caffe-1"><span class="nav-number">2.3.</span> <span class="nav-text">编译 Caffe</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#通用依赖"><span class="nav-number">2.3.1.</span> <span class="nav-text">通用依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编译"><span class="nav-number">2.3.2.</span> <span class="nav-text">编译</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">IBUMBLEBEE</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
